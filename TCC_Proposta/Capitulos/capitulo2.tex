%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CAPÍTULO 2
\chapter{FUNDAMENTAÇÃO TEÓRICA}  


\section{Variações de Tensão de Curta Duração}
Variações de tensão de curta duração (\sigla{VTCD}{Variações de Tensão de Curta Duração}) são desvios significativos no valor eficaz da tensão em curtos intervalos de tempo. 
Essas variações podem ser momentâneas ou temporárias, tendo como principais causas condições de falta, energização de grandes cargas que demandam correntes altas de partida e conexões frouxas intermitentes nos cabos de energia \cite{aneel2011qualidade, machado2006detecccao}.

Usualmente as VTCD referem-se à tensão fase-neutro, podendo ser descritas monofasicamente por dois parâmetros: amplitude e duração. A amplitude é definida pelo valor extremo do valor eficaz da tensão (também chamado de tensão remanescente) em relação à tensão nominal, no ponto de observação e enquanto durar o evento. Esse valor pode ser expresso em porcentagem ou em valor por unidade (pu) \cite{ons2gerenciamento}.

A duração das VTCD é caracterizada pelo tempo percorrido entre o momento em que o valor eficaz da tensão ultrapassa um determinado limiar e o momento em que volta a cruzar esse ponto, podendo ser expresso em segundos ou ciclos \cite{ons2gerenciamento}.


Na tabela \ref{tab:tipos} é mostrada uma classificação geral dos tipos de variações de tensão de curta duração, e na tabela \ref{tab:VTCD} são apresentados os critérios detalhados para a definição de cada tipo de variação de acordo com a norma vigente da ONS \cite{ons2gerenciamento}.

\begin{table}[H]
\centering
\caption{Tipos de VTCD}
\label{tab:tipos}
\scalebox{0.9}{
\begin{tabular}{ |c|c| }
\hline
\textbf{Tipo} & \textbf{Duração} \\ \hline
Instantâneos & 0.5 a 30 ciclos \\ \hline
Momentâneos & 30 ciclos a 3 segundos \\ \hline
Temporários & 3 segundos a 1 minuto \\ 
\hline
\end{tabular}}
\end{table}

\subsection{Valor Eficaz da Tensão}
\label{sec:rms}

Na definição da amplitude das variações de tensão é utilizado o valor eficaz (rms, da sigla em inglês \textit{root mean square}), também chamado de valor quadrático médio, que é uma medida estatística da magnitude de uma quantidade variável. 

O valor eficaz da tensão (Vref) é representado pela equação \ref{eq:1}, sendo $x(t)$ o sinal variável no tempo e $T$ seu período.

\begin{equation}
\label{eq:1}
Vref = \sqrt{\frac{1}{T}\int_0^T [x(t)]^2 dt}
\end{equation}
 
\subsection{Interrupção de Tensão (\textit{Interruption})}

A interrupção ocorre quando a amplitude da tensão descresce para um valor menor que 0,1 pu, em um período de até 1 minuto. Algumas de suas principais causas são condições de falhas no equipamento, falhas no sistema de energia e mau funcionamento de controladores \cite{ieee20091159}.

A figura \ref{fig:interrupt} ilustra a ocorrência de uma interrupção momentânea, com a tensão caindo para 0 durante aproximadamente 2 segundos. O primeiro gráfico apresenta a variação da tensão eficaz (rms) durante todo o evento, enquanto o segundo apresenta a variação do valor instantâneo da tensão durante o inicio da interrupção.    

\begin{figure}[H]
\centering
\includegraphics[width=8cm, height=6cm,keepaspectratio]{./Figuras/Interrupt.png}
\caption{Interrupção momentânea de tensão}
\label{fig:interrupt} \fonte{\cite{ieee20091159}}
\end{figure}

\subsection{Afundamento de Tensão (\textit{Voltage Sag})}

O afundamento ocorre quando a tensão decai para um valor entre 0,1 e 0,9 pu (tensão remanescente de 0,1 a 0,9 pu). Esse evento é geralmente associado à condições de defeito no sistema, comutação de grandes blocos de carga e acionamento de grandes motores \cite{ieee20091159}.

A figura \ref{fig:sag} ilustra um afundamento instantâneo com tensão remanescente de aproximadamente 0,2 pu. No primeiro gráfico, o afundamento é mostrado pela variação da tensão eficaz, com uma escala em segundos. No gráfico abaixo, a forma de onda completa da tensão (com escala em milisegundos) mostra uma oscilação maior do valor durante a duração do evento. 

\begin{figure}[H]
\centering
\includegraphics[width=8cm, height=6cm,keepaspectratio]{./Figuras/sag.png}
\caption{Afundamento instantâneo de tensão}
\label{fig:sag} \fonte{\cite{ieee20091159}}
\end{figure}

\subsection{Elevação de Tensão (\textit{Voltage Swell})}

A elevação de tensão é definida por um aumento na tensão eficaz acima de 1,1 pu, com duração descrita na tabela \ref{tab:VTCD}. Assim como ocorre com o afundamento, sua ocorrência está associada à condições de falhas no sistema, desligamento de grandes cargas ou bancos de capacitores \cite{ieee20091159}.

A figura \ref{fig:swell} ilustra uma condição de elevação instantânea de tensão em um sistema, com dois gráficos indicando as variações da tensão instantânea e da eficaz. 

\begin{figure}[H]
\centering
\includegraphics[width=8cm, height=6cm,keepaspectratio]{./Figuras/swell.png}
\caption{Elevação instantânea de tensão}
\label{fig:swell} \fonte{\cite{ieee20091159}}
\end{figure}

\begin{table}[H]
	\centering
	\caption{Variações de Tensão de Curta Duração}
	\label{tab:VTCD}
	\scalebox{0.7}{
	\begin{tabular}{m{3cm}|m{3cm}|m{3cm}|m{3cm}|}
    \hline
    \multicolumn{1}{|c|}{\textbf{Classificação}} & \textbf{Denominação} & \textbf{Duração da Variação} & \textbf{Amplitude da tensão} \\ \hline
    \multicolumn{1}{ |c  }{\multirow{2}{*}{Variação Momentânea de Tensão}} &
    \multicolumn{1}{ |c| }{Interrupção Momentânea de Tensão} & Inferior ou igual a três segundos & Inferior a 0,1 p.u \\ \cline{2-4}
    \multicolumn{1}{ |c  }{}             &
    \multicolumn{1}{ |c| }{Afundamento Momentânea de Tensão} & Superior ou igual a um ciclo e inferior ou igual a três segundos & Superior ou igual a 0,1 e inferior a 0,9 p.u   \\ \cline{2-4}
    \multicolumn{1}{ |c  }{}             &
    \multicolumn{1}{ |c| }{Elevação Momentânea de Tensão} & Superior ou igual a um ciclo e inferior ou igual a três segundos & Superior a 1,1 p.u   \\ \cline{1-4}
    \multicolumn{1}{ |c  }{\multirow{2}{*}{Variação Temporária de Tensão}} &
    \multicolumn{1}{ |c| }{Interrupção Temporária de Tensão} & Superior a três segundos e inferior a um minuto & Inferior a 0,1 p.u \\ \cline{2-4}
    \multicolumn{1}{ |c  }{}             &
    \multicolumn{1}{ |c| }{Afundamento Temporário de Tensão} & Superior a três segundos e inferior a um minuto & Superior ou igual a 0,1 e inferior a 0,9 p.u \\ \cline{2-4}
    \multicolumn{1}{ |c  }{}             &
    \multicolumn{1}{ |c| }{Elevação Temporária de Tensão} & Superior a três segundos e inferior a um minuto & Superior a 1,1 p.u \\ 
    \hline
	\end{tabular}}
\end{table}


\section{Microcontrolador PIC32MX795F512L}

Para este trabalho será utilizado o microcontrolador PIC32MX795F512L, fabricado pela empresa \textit{Microchip Technology Incorporated}, que possui unidade de processamento de 32 bits, 512 kB de memória Flash, 128 kB de memória RAM, frequência de operação de 80 MHz e faixa de operação de tensão de 2,3 V a 3,6 V \cite{microchip:pic32}.

O PIC32MX795F512L conta também com 5 Timers de 16 bits, sendo que dois pares podem ser combinados para formar dois Timers de 32 bits \cite{microchip:pic32}. Será explicado na seção 3 como esses Timers serão utilizados no trabalho.

Outra característica importante desse microcontrolador é a presença de uma interface de controle de acesso ethernet (MAC) de 10/100 Mbps \cite{microchip:pic32} que, em conjunto com o periférico relógio em tempo real (também presente no microcontrolador), permitirá configurar o dispositivo para funcionar como um servidor, salvando as informações de tipo, duração e hora das ocorrências de variações na tensão e disponibilizando-as para consulta online.

O microcontrolador PIC32MX795F512L será utilizado através da placa de desenvolvimento Cerebot MX7cK, que é fabricada pela empresa \textit{Digilent Incorporated}. Essa placa possui 52 pinos de entrada e saída, interface Ethernet 10/100, 5 entradas de interrupção externa e diversos outros periféricos, podendo ser alimentada via USB ou fonte AC-DC externa. \cite{cerebot:mx7ck}.

Um diagrama com os principais periféricos da Cerebot MX7cK é apresentado na figura \ref{fig:cerebot}:

\begin{figure}[H]
\centering
\includegraphics[width=8cm, height=6cm,keepaspectratio]{./Figuras/cerebotDiagram.png}
\caption{Diagrama do circuito da placa de desenvolvimento Cerebot MX7cK}
\label{fig:cerebot} \fonte{\cite{cerebot:mx7ck}}
\end{figure}


\section{Circuito Integrado ADE7758}

O ADE7758, fabricado pela empresa \textit{Analog Devices}, é um circuito integrado medidor de energia elétrica trifásica, de alta precisão, com interface serial e alimentação de 5V. Esse circuito conta com seis entradas analógicas, divididas em dois canais: tensão e corrente. O canal de tensão conta com três entradas: VAP, VBP e VCP.  \cite{analogdevices:ade7758} 

\begin{figure}[H]
\centering
\includegraphics[width=8cm, height=6cm,keepaspectratio]{./Figuras/ADE7758.png}
\caption{Configuração de pinos do circuito integrado ADE7758}
\label{fig:ade7758} \fonte{\cite{analogdevices:ade7758}}
\end{figure}

Para o propósito deste trabalho, o ADE7758 apresenta algumas funções muito úteis, descritas abaixo.

\subsection{Detecção de afundamento de tensão de linha}
\label{sec:sag}

O ADE7758 pode ser programado para detectar uma diminuição no valor absoluto da tensão de linha, abaixo de um limiar configurado no registrador de nível de afundamento (\textit{Sag level register}), por um número de meio ciclos.  

\begin{figure}[H]
\centering
\includegraphics[width=8cm, height=6cm,keepaspectratio]{./Figuras/SagDetec.png}
\caption{Detecção de afundamento de tensão}
\label{fig:SagDetec} \fonte{\cite{analogdevices:ade7758}}
\end{figure} 	

A figura \ref{fig:SagDetec} ilustra um exemplo dessa função. A tensão fica abaixo de um limiar definido no registrador de nível de afundamento (SAGLVL[7:0]), durante nove meio ciclos. Como o registrador de ciclos de afundamento indica um limiar de seis meio ciclos (SEGCYC[7:0]=0x06), o evento de afundamento começa a ser registrado após o fim do sexto meio ciclo, quando a flag que indica o afundamento é colocada em nível lógico alto para a fase de tensão correspondente (Bits 1 até 3 no registrador da interrupção)  \cite{analogdevices:ade7758}. %Pag 25 datasheet

%SAG LEVEL SET

\subsection{Detecção de Sobretensão}
\label{sec:swell}

Na figura \ref{fig:SwellDetec} é possível ver o comportamento da detecção de sobretensão, quando o valor absoluto da tensão excede um limiar configurado no registrador VPINTLVL[7:0]. O Bit 14 (\textit{PKV flag}) do registrador de interrupção é responsável por gravar a ocorrência da sobretensão. Assim como na detecção de tensão de pico, multiplas fases de tensão e corrente podem ser monitoradas individualmente a partir da configuração dos bits PKIRQSEL[5:7] do registrador MMODE \cite{analogdevices:ade7758}. 	

\begin{figure}[H]
\centering
\includegraphics[width=8cm, height=6cm,keepaspectratio]{./Figuras/SwellDetec.png}
\caption{Detecção de elevação de tensão}
\label{fig:SwellDetec} \fonte{\cite{analogdevices:ade7758}}
\end{figure}

\subsection{Medição de Frequência}

Com o circuito integrado ADE7758 é possível fazer a medição da frequência e do período da tensão. A fase que será analisada é selecionada no Bit 0 e Bit 1 do registrador MMODE, sendo que o registrador do período é o registrador FREQ, de 12 Bits \cite{analogdevices:ade7758}.

O Bit 7 do LCYCMODE seleciona se o registrador do período irá mostrar a frequência ou o período. Por padrão esse Bit é configurado em nível lógico baixo, com o registrador mostrando a medição da frequência. Caso o Bit seja configurado em nível lógico alto, o registrador irá mostrar o período.

\subsection{Medição de Tensão RMS}
\label{sec:rmsade}

Foi apresentado na seção \ref{sec:rms} o conceito de valor eficaz da tensão. O circuito integrado ADE7758 é capaz de calcular esse valor para cada uma das seis entradas analógicas, mantendo os resultados em diferentes registradores.

Os valores de tensão eficaz são salvos em registradores de 24 bits: AVRMS, BVRMS e CVRMS. 

